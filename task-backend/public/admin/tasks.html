<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin – Tasks</title>
  <style>
    body { font-family: sans-serif; background: #f8f8f8; padding: 20px; }
    h1 { color: #215432; text-align: center; }
    .controls { display: flex; gap: 10px; margin-bottom: 20px; }
    .input { padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: 200px; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; }
    th { background: #215432; color: white; text-align: left; }
  </style>
</head>
<body>
  <h1>Tasks</h1>

  <div class="controls">
    <input type="text" class="input" id="search" placeholder="Search by title..." />
    <select class="input" id="statusFilter">
      <option value="">All Status</option>
      <option value="Pending">Pending</option>
      <option value="Started">Started</option>
      <option value="Completed">Completed</option>
      <option value="Cancelled">Cancelled</option>
    </select>
  </div>

  <table id="taskTable">
    <thead>
      <tr>
        <th>Title</th>
        <th>Client</th>
        <th>Tasker</th>
        <th>Status</th>
        <th>Created</th>
        <th>Cancelled/Completed</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    let tasks = [];

    async function fetchTasks() {
      const res = await axios.get("/api/admin/tasks");
      tasks = res.data;
      render(tasks);
    }

    function render(data) {
      const tbody = document.querySelector("#taskTable tbody");
      tbody.innerHTML = "";

      data.forEach(t => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${t.title}</td>
          <td>${t.clientName}</td>
          <td>${t.taskerName || "—"}</td>
          <td>${t.status}</td>
          <td>${new Date(t.createdAt).toLocaleString()}</td>
          <td>${t.completedAt || t.cancelledAt || "—"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("search").addEventListener("input", (e) => {
      const term = e.target.value.toLowerCase();
      const filtered = tasks.filter(t => t.title.toLowerCase().includes(term));
      render(filtered);
    });

    document.getElementById("statusFilter").addEventListener("change", (e) => {
      const value = e.target.value;
      const filtered = value ? tasks.filter(t => t.status === value) : tasks;
      render(filtered);
    });

    fetchTasks();
  </script>
</body>
</html>
