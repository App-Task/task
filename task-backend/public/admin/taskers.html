<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ Taskers</title>
  <style>
    body { font-family: sans-serif; background: #f8f8f8; padding: 20px; }
    h1 { color: #215432; text-align: center; }
    .controls { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .search-input { padding: 8px; width: 250px; border-radius: 6px; border: 1px solid #ccc; }
    .card {
      background: white; border-radius: 10px; padding: 15px; margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .actions button {
      margin-right: 6px; padding: 6px 10px;
      border: none; border-radius: 4px; cursor: pointer;
    }
    .block { background: #ff9800; color: white; }
    .delete { background: #f44336; color: white; }
    .unblock { background: #4caf50; color: white; }
    .verify { background: #2196f3; color: white; }
    .decline { background: #9c27b0; color: white; }
    .doc-link { display: inline-block; margin-right: 10px; color: #1a73e8; text-decoration: none; }
  </style>
</head>
<body>
  <h1>Taskers</h1>

  <div class="controls">
    <input type="text" id="search" class="search-input" placeholder="Search by name or email..." />
  </div>

  <div id="taskersContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  let allTaskers = [];
  let currentPage = 1;
  let totalTaskers = 0;

  async function fetchTaskers() {
    const res = await axios.get(`/api/admin/taskers?page=${currentPage}&limit=10`);
    allTaskers = res.data.taskers;
    totalTaskers = res.data.total;

    renderTaskers(allTaskers);
    renderPagination();
  }

  function renderTaskers(data) {
    const tbody = document.querySelector("#taskersTable tbody");
    tbody.innerHTML = "";

    data.forEach(t => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${t.name}</td>
        <td>${t.email}</td>
        <td>${t.phone}</td>
        <td>${t.location}</td>
        <td>${t.verificationStatus}</td>
        <td>
          <button class="${t.isBlocked ? 'unblock' : 'block'}" onclick="toggleBlock('${t._id}', ${!t.isBlocked})">
            ${t.isBlocked ? 'Unblock' : 'Block'}
          </button>
          <button class="delete" onclick="deleteTasker('${t._id}')">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function renderPagination() {
    const totalPages = Math.ceil(totalTaskers / 10);
    const controlsDiv = document.querySelector(".controls");

    const old = document.querySelector(".pagination-buttons");
    if (old) old.remove();

    let html = '<div class="pagination-buttons">';
    for (let i = 1; i <= totalPages; i++) {
      html += `<button onclick="goToPage(${i})" style="margin-left: 6px;">${i}</button>`;
    }
    html += '</div>';
    controlsDiv.insertAdjacentHTML("beforeend", html);
  }

  function goToPage(page) {
    currentPage = page;
    fetchTaskers();
  }

  async function toggleBlock(id, block) {
    const action = block ? "block" : "unblock";
    await axios.patch(`/api/admin/taskers/${id}/${action}`);
    fetchTaskers();
  }

  async function deleteTasker(id) {
    if (confirm("Are you sure you want to delete this tasker?")) {
      await axios.delete(`/api/admin/taskers/${id}`);
      fetchTaskers();
    }
  }

  fetchTaskers();
</script>

</body>
</html>
