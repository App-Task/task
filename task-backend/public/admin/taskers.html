<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin ‚Äì Taskers</title>
  <style>
    body { font-family: sans-serif; background: #f8f8f8; padding: 20px; }
    h1 { color: #215432; text-align: center; }
    .controls { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .search-input { padding: 8px; width: 250px; border-radius: 6px; border: 1px solid #ccc; }
    .card {
      background: white; border-radius: 10px; padding: 15px; margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .actions button {
      margin-right: 6px; padding: 6px 10px;
      border: none; border-radius: 4px; cursor: pointer;
    }
    .block { background: #ff9800; color: white; }
    .delete { background: #f44336; color: white; }
    .unblock { background: #4caf50; color: white; }
    .verify { background: #2196f3; color: white; }
    .decline { background: #9c27b0; color: white; }
    .doc-link { display: inline-block; margin-right: 10px; color: #1a73e8; text-decoration: none; }
  </style>
</head>
<body>
  <h1>Taskers</h1>

  <div class="controls">
    <input type="text" id="search" class="search-input" placeholder="Search by name or email..." />
  </div>

  <div id="taskersContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    let taskers = [];

    async function fetchTaskers() {
      const res = await axios.get("/api/admin/taskers");
      taskers = res.data;
      renderTaskers(taskers);
    }

    function renderTaskers(data) {
      const container = document.getElementById("taskersContainer");
      container.innerHTML = "";

      data.forEach(t => {
        const docsHtml = t.documents.map(doc => 
          `<a href='${doc}' class='doc-link' target='_blank'>üìÑ ${doc.split('/').pop()}</a>`).join("");

        const reviewsHtml = t.reviews.map(r =>
          `<li>${r.rating}‚≠ê ‚Äì ${r.comment}</li>`).join("") || "No reviews";

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${t.name}</h3>
          <p><strong>Email:</strong> ${t.email}</p>
          <p><strong>Phone:</strong> ${t.phone}</p>
          <p><strong>Location:</strong> ${t.location}</p>
          <p><strong>Verified:</strong> ${t.verificationStatus}</p>
          <div><strong>Docs:</strong><br/>${docsHtml}</div>
          <div style="margin-top: 8px;">
            <button class="verify" onclick="verify('${t._id}', 'accepted')">Accept</button>
            <button class="decline" onclick="verify('${t._id}', 'declined')">Decline</button>
            <button class="${t.isBlocked ? 'unblock' : 'block'}" onclick="toggleBlock('${t._id}', ${!t.isBlocked})">
              ${t.isBlocked ? 'Unblock' : 'Block'}
            </button>
            <button class="delete" onclick="deleteTasker('${t._id}')">Delete</button>
          </div>
          <div style="margin-top:10px;"><strong>Reviews:</strong><ul>${reviewsHtml}</ul></div>
        `;
        container.appendChild(card);
      });
    }

    async function verify(id, status) {
      await axios.patch(`/api/admin/verify-tasker/${id}`, { status });
      fetchTaskers();
    }

    async function toggleBlock(id, block) {
      const action = block ? 'block' : 'unblock';
      await axios.patch(`/api/admin/taskers/${id}/${action}`);
      fetchTaskers();
    }

    async function deleteTasker(id) {
      if (confirm("Are you sure you want to delete this tasker?")) {
        await axios.delete(`/api/admin/taskers/${id}`);
        fetchTaskers();
      }
    }

    document.getElementById("search").addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      const filtered = taskers.filter(t => t.name.toLowerCase().includes(term) || t.email.toLowerCase().includes(term));
      renderTaskers(filtered);
    });

    fetchTaskers();
  </script>
</body>
</html>
