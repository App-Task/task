<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin – Taskers</title>
  <style>
    body { font-family: sans-serif; background: #f8f8f8; padding: 20px; }
    h1 { color: #215432; text-align: center; }
    .controls { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .search-input { padding: 8px; width: 250px; border-radius: 6px; border: 1px solid #ccc; }
    .card {
      background: white; border-radius: 10px; padding: 15px; margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .actions button {
      margin-right: 6px; padding: 6px 10px;
      border: none; border-radius: 4px; cursor: pointer;
    }
    .block { background: #ff9800; color: white; }
    .delete { background: #f44336; color: white; }
    .unblock { background: #4caf50; color: white; }
    .verify { background: #2196f3; color: white; }
    .decline { background: #9c27b0; color: white; }
    .doc-link { display: inline-block; margin-right: 10px; color: #1a73e8; text-decoration: none; }
  </style>
</head>
<body>

    <div style="margin-bottom: 20px;">
        <a href="/admin/index.html" style="background: #215432; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: bold;">← Back to Dashboard</a>
      </div>
      
  <h1>Taskers</h1>

  <div class="controls">
    <input type="text" id="search" class="search-input" placeholder="Search by name or email..." />
  </div>

  <div id="taskersContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  let allTaskers = [];
  let currentPage = 1;
  let totalTaskers = 0;

  async function fetchTaskers() {
    const res = await axios.get(`/api/admin/taskers?page=${currentPage}&limit=10`);
    allTaskers = res.data.taskers;
    totalTaskers = res.data.total;

    renderTaskers(allTaskers);
    renderPagination();
  }

  function renderTaskers(data) {
  const container = document.getElementById("taskersContainer");
  container.innerHTML = "";

  data.forEach(t => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <h3>${t.name}</h3>
      <p><strong>Email:</strong> ${t.email}</p>
      <p><strong>Phone:</strong> ${t.phone}</p>
      <p><strong>Location:</strong> ${t.location}</p>
      <p><strong>Status:</strong> ${t.verificationStatus}</p>
      ${t.image ? `<img src="${t.image}" alt="${t.name}" style="width:80px;height:80px;border-radius:8px;">` : ""}
      
      <p><strong>Documents:</strong><br>
        ${t.documents.map((doc, i) => `<a class="doc-link" href="${doc}" target="_blank">Doc ${i+1}</a>`).join("")}
      </p>
      
      <p><strong>Reviews:</strong><br>
        ${t.reviews.length === 0 ? "No reviews" : t.reviews.map(r => `<div>⭐ ${r.rating} – ${r.comment}</div>`).join("")}
      </p>
      
      <div class="actions">
        <button class="${t.isBlocked ? 'unblock' : 'block'}" onclick="toggleBlock('${t._id}', ${!t.isBlocked})">
          ${t.isBlocked ? 'Unblock' : 'Block'}
        </button>
        <button class="delete" onclick="deleteTasker('${t._id}')">Delete</button>
      </div>
    `;
    container.appendChild(div);
  });
}

  function renderPagination() {
    const totalPages = Math.ceil(totalTaskers / 10);
    const controlsDiv = document.querySelector(".controls");

    const old = document.querySelector(".pagination-buttons");
    if (old) old.remove();

    let html = '<div class="pagination-buttons">';
    for (let i = 1; i <= totalPages; i++) {
      html += `<button onclick="goToPage(${i})" style="margin-left: 6px;">${i}</button>`;
    }
    html += '</div>';
    controlsDiv.insertAdjacentHTML("beforeend", html);
  }

  function goToPage(page) {
    currentPage = page;
    fetchTaskers();
  }

  async function toggleBlock(id, block) {
    const action = block ? "block" : "unblock";
    await axios.patch(`/api/admin/taskers/${id}/${action}`);
    fetchTaskers();
  }

  async function deleteTasker(id) {
    if (confirm("Are you sure you want to delete this tasker?")) {
      await axios.delete(`/api/admin/taskers/${id}`);
      fetchTaskers();
    }
  }

  fetchTaskers();
</script>

</body>
</html>
